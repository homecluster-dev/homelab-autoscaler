apiVersion: infra.homecluster.dev/v1alpha1
kind: Node
metadata:
  name: group1-worker-node-1
  namespace: homelab-autoscaler-system
  labels:
    group: group1
spec:
  kubernetesNodeName: homelab-autoscaler-test-e2e-worker
  healthcheckPeriod: 1
  startupPodSpec:
    image: busybox:latest
    command:
      - /bin/sh
    args:
      - -c
      - echo startup
  shutdownPodSpec:
    image: busybox:latest
    command:
      - /bin/sh
    args:
      - -c
      - echo shutdown
  healthcheckPodSpec:
    serviceAccount: kubectl-sa
    image: alpine/k8s:1.34.1
    command:
      - /bin/sh
      - -c
      - |
        NODE="homelab-autoscaler-test-e2e-worker"
        STATUS=$(kubectl get node "$NODE" -o json)
        if echo "$STATUS" | grep -q '"unschedulable":true'; then
          echo "Node $NODE is unschedulable"
          exit 1
        fi
        echo "Node $NODE is schedulable"
---
apiVersion: infra.homecluster.dev/v1alpha1
kind: Node
metadata:
  name: group1-worker-node-2
  namespace: homelab-autoscaler-system
  labels:
    group: group1
spec:
  kubernetesNodeName: homelab-autoscaler-test-e2e-worker2
  healthcheckPeriod: 1
  startupPodSpec:
    image: busybox:latest
    command:
      - /bin/sh
    args:
      - -c
      - echo startup
  shutdownPodSpec:
    image: busybox:latest
    command:
      - /bin/sh
    args:
      - -c
      - echo shutdown
  healthcheckPodSpec:
    serviceAccount: kubectl-sa
    image: alpine/k8s:1.34.1
    command:
      - /bin/sh
      - -c
      - |
        NODE="homelab-autoscaler-test-e2e-worker2"
        STATUS=$(kubectl get node "$NODE" -o json)
        if echo "$STATUS" | grep -q '"unschedulable":true'; then
          echo "Node $NODE is unschedulable"
          exit 1
        fi
        echo "Node $NODE is schedulable"