apiVersion: infra.homecluster.dev/v1alpha1
kind: Node
metadata:
  name: group2-worker-node-3
  namespace: homelab-autoscaler-system
  labels:
    group: group2
spec:
  kubernetesNodeName: homelab-autoscaler-test-e2e-worker3
  healthcheckPeriod: 2
  startupPodSpec:
    image: busybox:latest
    command:
      - /bin/sh
    args:
      - -c
      - echo startup
  shutdownPodSpec:
    image: busybox:latest
    command:
      - /bin/sh
    args:
      - -c
      - echo shutdown
  healthcheckPodSpec:
    serviceAccount: kubectl-sa
    image: alpine/k8s:1.34.1
    command:
      - /bin/sh
      - -c
      - |
        NODE="homelab-autoscaler-test-e2e-worker3"
        STATUS=$(kubectl get node "$NODE" -o json)
        if echo "$STATUS" | grep -q '"unschedulable":true'; then
          echo "Node $NODE is unschedulable"
          exit 1
        fi
        echo "Node $NODE is schedulable"
---
apiVersion: infra.homecluster.dev/v1alpha1
kind: Node
metadata:
  name: group2-worker-node-4
  namespace: homelab-autoscaler-system
  labels:
    group: group2
spec:
  kubernetesNodeName: homelab-autoscaler-test-e2e-worker4
  healthcheckPeriod: 2
  startupPodSpec:
    image: busybox:latest
    command:
      - /bin/sh
    args:
      - -c
      - echo startup
  shutdownPodSpec:
    image: busybox:latest
    command:
      - /bin/sh
    args:
      - -c
      - echo shutdown
  healthcheckPodSpec:
    serviceAccount: kubectl-sa
    image: alpine/k8s:1.34.1
    command:
      - /bin/sh
      - -c
      - |
        NODE="homelab-autoscaler-test-e2e-worker4"
        STATUS=$(kubectl get node "$NODE" -o json)
        if echo "$STATUS" | grep -q '"unschedulable":true'; then
          echo "Node $NODE is unschedulable"
          exit 1
        fi
        echo "Node $NODE is schedulable"